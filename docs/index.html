<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>EGS Brachy: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">EGS Brachy
   </div>
   <div id="projectbrief">An egs++ user code for rapid brachytherapy calculations</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">EGS Brachy Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#gen_info">General Information</a></li>
<li class="level1"><a href="#license">License</a></li>
<li class="level1"><a href="#installationinstruct">Installation instructions (including EGSnrc installation)</a></li>
<li class="level1"><a href="#usage">Usage</a><ul><li class="level2"><a href="#runcontrol">Run Control</a></li>
<li class="level2"><a href="#runmodes">Run Modes</a></li>
<li class="level2"><a href="#geomspec">Geometry Specification</a><ul><li class="level3"><a href="#ctdata">Using CT data to create phantoms</a></li>
<li class="level3"><a href="#geomlib">The geometry library</a></li>
</ul>
</li>
<li class="level2"><a href="#scoringopts">Scoring options</a><ul><li class="level3"><a href="#vcfiles">Volume correction files</a></li>
<li class="level3"><a href="#specscoring">Spectrum Scoring Options</a></li>
<li class="level3"><a href="#phspscoring">Phase Space Scoring Options</a></li>
</ul>
</li>
<li class="level2"><a href="#sourcedef">Source definition</a><ul><li class="level3"><a href="#varweight">Variable source weighting</a></li>
<li class="level3"><a href="#phspsources">Phase Space Sources</a></li>
</ul>
</li>
<li class="level2"><a href="#transport">Transport Parameters</a></li>
<li class="level2"><a href="#varreduction">Variance Reduction</a><ul><li class="level3"><a href="#recycling">Particle Recycling</a></li>
<li class="level3"><a href="#rangerejection">Range Rejection</a></li>
<li class="level3"><a href="#bremsplit">Bremsstrahlung Splitting</a></li>
<li class="level3"><a href="#bcse">Bremsstrahlung Cross Section Enhancement</a></li>
</ul>
</li>
<li class="level2"><a href="#voxvc">Voxel volume correction details</a><ul><li class="level3"><a href="#sourcevc">Fast voxel volume corrections for sources</a></li>
<li class="level3"><a href="#genvc">General purpose volume corrections</a></li>
<li class="level3"><a href="#vcfile">Volume calculations from file</a></li>
<li class="level3"><a href="#rngvc">Random Number Generator for volume corrections</a></li>
</ul>
</li>
<li class="level2"><a href="#outputfiles">Output files</a><ul><li class="level3"><a href="#dosefiles">3ddose files</a></li>
<li class="level3"><a href="#egsphant">egsphant file</a></li>
<li class="level3"><a href="#voxinfo">Voxel info files</a></li>
</ul>
</li>
<li class="level2"><a href="#runsim">Running a simulation</a></li>
</ul>
</li>
<li class="level1"><a href="#runtests">Test Suite</a><ul><li class="level2"><a href="#setup">Setup</a></li>
<li class="level2"><a href="#testsuite">Running the test suite</a></li>
<li class="level2"><a href="#curtests">A list of the current tests</a></li>
</ul>
</li>
<li class="level1"><a href="#library">The egs_brachy Library</a><ul><li class="level2"><a href="#libgeom">The Geometry Library</a></li>
<li class="level2"><a href="#libtransport">Transport Parameters</a></li>
<li class="level2"><a href="#libspectra">Spectra</a></li>
<li class="level2"><a href="#libmedia">Media &amp; Muen Data</a></li>
<li class="level2"><a href="#libexamples">Example egsinp files</a></li>
</ul>
</li>
<li class="level1"><a href="#makedocs">Documentation</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="egs_brachy_main"></a></p>
<h1><a class="anchor" id="gen_info"></a>
General Information</h1>
<p>egs_brachy is an egs++ application for rapid brachytherapy calculations for both photon and electron sources. The current documentation serves as a Technical Reference Manual to complement the egs_brachy user manual (<a href="https://clrp-code.github.io/egs_brachy/docs/egs_brachy_user_manual.pdf">https://clrp-code.github.io/egs_brachy/docs/egs_brachy_user_manual.pdf</a>) and our initial egs_brachy paper (<a href="https://clrp-code.github.io/egs_brachy/docs/egs_brachy_paper2016.pdf">https://clrp-code.github.io/egs_brachy/docs/egs_brachy_paper2016.pdf</a>): MJP Chamberland, REP Taylor, DWO Rogers, and RM Thomson, egs_brachy: a versatile and fast Monte Carlo code for brachytherapy, Phys. Med. Biol. 61, 8214-8231 (2016). Please cite this paper when egs_brachy is used in publications.</p>
<p>egs_brachy was written by <a href="http://randlet.com">Randle Taylor</a> in collaboration with Marc Chamberland, Dave Rogers, and Rowan Thomson of the <a href="http://www.physics.carleton.ca/clrp/">Carleton Laboratory for Radiotherapy Physics</a>.</p>
<p>For more information please contact:</p><ul>
<li>Rowan Thomson (<a href="#" onclick="location.href='mai'+'lto:'+'rth'+'om'+'son'+'@p'+'hys'+'ic'+'s.c'+'ar'+'let'+'on'+'.ca'; return false;">rthom<span style="display: none;">.nosp@m.</span>son@<span style="display: none;">.nosp@m.</span>physi<span style="display: none;">.nosp@m.</span>cs.c<span style="display: none;">.nosp@m.</span>arlet<span style="display: none;">.nosp@m.</span>on.c<span style="display: none;">.nosp@m.</span>a</a>) -or-</li>
<li>Dave Rogers (<a href="#" onclick="location.href='mai'+'lto:'+'dro'+'ge'+'rs@'+'ph'+'ysi'+'cs'+'.ca'+'rl'+'eto'+'n.'+'ca'; return false;">droge<span style="display: none;">.nosp@m.</span>rs@p<span style="display: none;">.nosp@m.</span>hysic<span style="display: none;">.nosp@m.</span>s.ca<span style="display: none;">.nosp@m.</span>rleto<span style="display: none;">.nosp@m.</span>n.ca</a>) -or-</li>
<li>Randle Taylor (<a href="#" onclick="location.href='mai'+'lto:'+'ran'+'dl'+'e.t'+'ay'+'lor'+'@g'+'mai'+'l.'+'com'; return false;">randl<span style="display: none;">.nosp@m.</span>e.ta<span style="display: none;">.nosp@m.</span>ylor@<span style="display: none;">.nosp@m.</span>gmai<span style="display: none;">.nosp@m.</span>l.com</a>)</li>
</ul>
<h1><a class="anchor" id="license"></a>
License</h1>
<p>The egs_brachy code (all pieces of code associated with the egs_brachy code system) is copyrighted Rowan Thomson, Dave Rogers, Randle Taylor, and Marc Chamberland. egs_brachy is distributed in the hope that it will be useful, but without any warranty; without even the implied warranty of merchantability or fitness for a particular purpose. egs_brachy is distributed as free software according to the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option), any later version (<a href="https://www.gnu.org/licenses/">https://www.gnu.org/licenses/</a>). (See also section 2 of the User Manual for egs_brachy: <a href="https://clrp-code.github.io/egs_brachy/docs/egs_brachy_user_manual.pdf">https://clrp-code.github.io/egs_brachy/docs/egs_brachy_user_manual.pdf</a>)</p>
<h1><a class="anchor" id="installationinstruct"></a>
Installation instructions (including EGSnrc installation)</h1>
<p>For a more detailed version of the installation instructions, see section 3 of the User Manual for egs_brachy (<a href="https://clrp-code.github.io/egs_brachy/docs/egs_brachy_user_manual.pdf">https://clrp-code.github.io/egs_brachy/docs/egs_brachy_user_manual.pdf</a>). Clone the CLRP fork of the EGSnrc repository: </p><pre class="fragment">git clone git@github.com:clrp-code/EGSnrc_with_egs_brachy.git EGSnrc
cd EGSnrc
</pre><p>Checkout the most-up-to-date 'egs_brachy' branch and download the egs_brachy user code: </p><pre class="fragment">git checkout egs_brachy
git submodule update --init --recursive
</pre><p>Finally, configure EGSnrc by following the instructions for your OS (skip Step 2, which is already completed if youâ€™ve been following these instructions):</p>
<ul>
<li>Linux: <a href="https://github.com/nrc-cnrc/EGSnrc/wiki/Install-EGSnrc-on-Linux">https://github.com/nrc-cnrc/EGSnrc/wiki/Install-EGSnrc-on-Linux</a></li>
<li>Mac: <a href="https://github.com/nrc-cnrc/EGSnrc/wiki/Install-EGSnrc-on-OS-X-El-Capitan">https://github.com/nrc-cnrc/EGSnrc/wiki/Install-EGSnrc-on-OS-X-El-Capitan</a></li>
<li>Windows: <a href="https://github.com/nrc-cnrc/EGSnrc/wiki/Install-EGSnrc-on-Windows">https://github.com/nrc-cnrc/EGSnrc/wiki/Install-EGSnrc-on-Windows</a></li>
</ul>
<p>At this point you should have everything required to run egs_brachy. If you did not choose to compile it when configuring EGSnrc, you should do so now: </p><pre class="fragment">cd $EGS_HOME/egs_brachy
make
</pre><h1><a class="anchor" id="usage"></a>
Usage</h1>
<h2><a class="anchor" id="runcontrol"></a>
Run Control</h2>
<p>egs_brachy uses the same run control block as other egs++ user codes with the addition of one extra input <code>egsdat file format</code> which you can use to tell egs_brachy to output its egsdat file in gzip format. Using gzip format can result in significantly smaller egsdat file sizes for simulations with a large number of regions defined.</p>
<pre class="fragment">:start run control:
    ncase = 10000
    nbatch=1
    geometry error limit = 10
    egsdat file format = gzip # gzip or text
:stop run control:
</pre><h2><a class="anchor" id="runmodes"></a>
Run Modes</h2>
<p>There are currently three different run modes available in egs_brachy:</p>
<ol type="1">
<li>'normal' (default): a regular simulation. For an example see <a href="https://github.com/clrp-code/egs_brachy/blob/master/egs_brachy/tests/seeds_in_xyz/seeds_in_xyz.egsinp">tests/seeds_in_xyz/seeds_in_xyz.egsinp</a>.</li>
<li>'superposition' : This type of simulation requires the used of an EGS_ASwitchedEnvelope as the simulation geometry. At the start of every history only a single inscribed geometry will be activated. This allows you to explore the effects of intersource attenuation by performing TG-43 dose superposition type calculations. For an example see <a href="https://github.com/clrp-code/egs_brachy/blob/master/egs_brachy/tests/tg43mode/tg43mode.egsinp">tests/tg43mode/tg43mode.egsinp</a>.</li>
<li>'volume correction only': Just run the volume correction routines, print the results and then quit. No actual dose calculations will be done. For an example see <a href="https://github.com/clrp-code/egs_brachy/blob/master/egs_brachy/tests/volume_correction/vc.egsinp">tests/volume_correction/vc.egsinp</a>.</li>
</ol>
<p>The run mode is set using a 'run mode' input block:</p>
<pre class="fragment">:start run mode:

    run mode = normal # 'normal', 'superposition', or 'volume correction only'

:stop run mode:
</pre><p>In simulations with more than a single source, egs_brachy uses the first source as a particle generator. That is, all particles are initiated at the location of the first source and transported until they escape the source geometry. From there, the particle is moved to the location of the next source before transport continues (more accurately, a new particle is added to the top of the stack at the location of the chosen source and the original particle is killed).</p>
<p>This behaviour can be disabled by setting <code>single generator = no</code> in the run mode block (see <a href="https://github.com/clrp-code/egs_brachy/blob/master/egs_brachy/tests/single_generator/single_generator.egsinp">tests/single_generator/single_generator.egsinp</a>).</p>
<pre class="fragment">:start run mode:
    run mode = normal
    single generator = no
:stop run mode:</pre><p>Disabling the single generator (see <a href="https://github.com/clrp-code/egs_brachy/blob/master/egs_brachy/tests/single_generator/multiple_generator.egsinp">tests/single_generator/multiple_generator.egsinp</a>) mode may be slightly faster for some simulations (there is an extra call to howfar for every particle escaping the source geometry in single generator mode). Note that in some situations (particle recycling for example) single generator will always be enabled by egs_brachy.</p>
<h2><a class="anchor" id="geomspec"></a>
Geometry Specification</h2>
<p>In general, arbitrary egs++ geometries can be included in a simulation although, for the sake of efficiency, it is expected that EGS_AEnvelope geometries will be used for most simulations.</p>
<p>There are three egs_brachy specific input keys that are required for the 'geometry definition' input block (in addition to the standard egs++ 'simulation geometry' key):</p>
<ol type="1">
<li>'source geometries' : this key specifies which geometries define the actual brachytherapy source object. This may be a single geometry name (e.g. when using the <code>egs_glib</code> shim to load an externally defined geometry) or a list of all the sub-geometries used to compose a single source geometry when definining geometries inline.</li>
<li>'phantom geometries': this tells egs_brachy which geometries to score dose in (1 or more phantom geometries are required). Currently 3 geometry types are allowed to be used as phantoms:<ol type="a">
<li>EGS_XYZGeometry (library egs_ndgeometry, see <a href="https://github.com/clrp-code/egs_brachy/blob/master/egs_brachy/tests/seeds_in_xyz/seeds_in_xyz.egsinp">tests/seeds_in_xyz/seeds_in_xyz.egsinp</a>)</li>
<li>EGS_RZGeometry (library egs_rz, see <a href="https://github.com/clrp-code/egs_brachy/blob/master/egs_brachy../tests/stepped_source/stepped.egsinp">tests/stepped_source/stepped.egsinp</a>)</li>
<li>EGS_cSpheres (library egs_spheres, see <a href="../tests/scatter/scatter.egsinp">tests/scatter/scatter.egsinp</a>)</li>
</ol>
</li>
<li>'source envelope geometry': this input is only required for superposition run mode and must name the EGS_ASwitchedEnvelope geometry that contains the sources.</li>
</ol>
<p>Other phantom geometry types could be added in future provided they implement the getBound, getNRegDir, and getMass methods of the EGS_BaseGeometry class.</p>
<p>An (abbreviated) example geometry specification might look like: </p><pre class="fragment">:start geometry definition:

  # all geometries that are a part of the source
  source geometries = planes, end_cap_1, seed_middle, end_cap_2, seed

  phantom geometries = phantom

  simulation geometry = phantom_w_seeds

  # only required for superposition run mode
  source envelope geometry = phantom_w_seeds

  :start geometry:

      name = phantom
      library = egs_ndgeometry
      type    = EGS_XYZGeometry

      # rest of geom definition

  :stop geometry:

  :start geometry:
      library = egs_planes
      name = planes
      # ...
  :stop geometry:

  :start geometry:
        name = end_cap_1
        #...
  :stop geometry:

  :start geometry:
        name = seed_middle
        #...
  :stop geometry:

  :start geometry:
        name = end_cap_2
        #...
  :stop geometry:

  :start geometry:

      library = egs_cdgeometry
      name = seed
      base geometry = planes
      set geometry = 0 end_cap_1
      set geometry = 1 seed_middle
      set geometry = 2 end_cap_2

  :stop geometry:

  :start geometry:

      library = egs_autoenvelope
      name = phantom_w_seeds
      base geometry = phantom

      :start inscribed geometry:

          inscribed geometry name = seed

          # rest of auto envelope inscribed geom definition

      :stop inscribed geometry:

  :stop geometry:

:stop geometry definition:</pre><h3><a class="anchor" id="ctdata"></a>
Using CT data to create phantoms</h3>
<p>Using the <code>egs_glib</code> geometry library you can construct an <code>EGS_XYZGeometry</code> using a <code>.egsphant</code> file like so:</p>
<pre class="fragment">:start geometry:
    library = egs_glib
    type = egsphant
    name = my_egsphant_geom
    egsphant file = /path/to/some/egsphant/file
    density file = /path/to/density/file
:stop geometry:</pre><p>The egsphant file may either be a typical .egsphant text file or gzipped .egsphant.gz file, and the latter compressed format is often advantageous in terms of memory) The density file indicates to egs_brachy the nominal density of each medium in the egsphant (voxel-by-voxel densities are defined in the egsphant file), and currently egs_brachy can read these data from a (a) material.dat file, (b) pegs4 data file, or (c) a simple text file of the format:</p>
<pre class="fragment">MEDIUM=WATER
RHO=1.000
MEDIUM=AIR
RHO=1.2E-3</pre><p><em>Note the egs_glib geometry library in the main EGSnrc repository does not currently contain support for egsphant files. The egs_glib contained in the egs_brachy git branch is customized to include support for egsphant files.</em></p>
<p>It is also possible to use the egs_ndgeometry library to contstruct an <code>EGS_XYZGeometry</code> using a <code>.egsphant</code> file like so:</p>
<pre class="fragment">:start geometry:

    library = egs_ndgeometry
    type =  EGS_XYZGeometry
    name = my_egsphant_geom
    egsphant file = /path/to/some/egsphant/file
    ct ramp = /path/to/ramp/file.ramp

:stop geometry:</pre><p>See the <code>egs_ndgeometry</code> documentation for details about the format of the ct ramp file. Note, however, that the egs_ndgeometry approach assumes that there is no overlap in voxel mass densities for different media in the egsphant, i.e., each medium has a distinct and non-overlapping range of mass densities. This is often <em>not</em> the case for brachytherapy phantoms, and so using the <code>egs_glib</code> geometry with <code>.egsphant</code> files (gzip format) is recommended.</p>
<h3><a class="anchor" id="geomlib"></a>
The geometry library</h3>
<p>The geometry library (see <a href="#libgeom">The Geometry Library</a> below) consists of useful phantom geometries ( <a href="../lib/geometry/phantoms">lib/geometry/phantoms</a>), source geometries and radioactivity distributions <a href="../lib/geometry/sources">lib/geometry/sources</a>, eye plaques <a href="../lib/geometry/eye_plaques">lib/geometry/eye_plaques</a> and sets of transformations <a href="../lib/geometry/transformations/">lib/geometry/transformations/</a>.</p>
<h2><a class="anchor" id="scoringopts"></a>
Scoring options</h2>
<p>The 'scoring options' input block currently has the following keys:</p>
<ul>
<li>'muen file': path to the file containing the muen data required for the simulation. See the MuenDataParser class for more information about the format of this file.</li>
<li>'muen for media': (Optional) a list of the materials that muen data is required for. Dose will be set to 0 for any phantom media that don't have muen data available. (Can be used instead of or in conjunction with <code>muen for medium</code>).</li>
<li>'muen for medium': (Optional) one or more input blocks which specify the muen dataset to be used for a given transport medium. (Can be used instead of or in conjunction with <code>muen for media</code>) This allows you to, for example, transport particles in tissue but score in water with notation Dw,m according to the conventions of TG-186.</li>
</ul>
<pre class="fragment">    :start muen for medium:
        transport medium = WATER
        scoring medium = TISSUE
    :stop muen for medium:
</pre><ul>
<li>'score tracklength dose' : (Optional) Controls whether dose using a tracklength estimator is scored in the phantom geometries. The choices are 'yes' (default) or 'no'.</li>
<li>'score energy deposition' : (Optional) Controls whether dose from particle interactions is scored in the phantom geometries. The choices are 'yes' or 'no' (default). See <a href="https://github.com/clrp-code/egs_brachy/blob/master/egs_brachy/tests/brem_cyl/brem_cyl.egsinp">tests/brem_cyl/brem_cyl.egsinp</a> for an example</li>
<li>'score scatter dose' : (Optional) Controls whether scatter dose (normalized to total radiant energy) is scored in the phantom geometries. The choices are 'yes' or 'no' (default). See <a href="https://github.com/clrp-code/egs_brachy/blob/master/egs_brachy/tests/scatter/scatter.egsinp">tests/scatter/scatter.egsinp</a> for an example.</li>
<li>'spectrum scoring': (Optional) zero or more input blocks specifying spectra to score (described below). See <a href="https://github.com/clrp-code/egs_brachy/blob/master/egs_brachy/tests/spec_absolute/spec_absolute.egsinp">tests/spec_absolute/spec_absolute.egsinp</a>, <a href="https://github.com/clrp-code/egs_brachy/blob/master/egs_brachy/tests/spec_eflu/spec_eflu.egsinp">tests/spec_eflu/spec_eflu.egsinp</a>, and <a href="https://github.com/clrp-code/egs_brachy/blob/master/egs_brachy/tests/spec_vox/spec_vox.egsinp">tests/spec_vox/spec_vox.egsinp</a> for examples.</li>
<li>'phsp scoring': (Optional) zero or one input block specifying whether to score a phase space on the surface of the source (described below). See <a href="https://github.com/clrp-code/egs_brachy/blob/master/egs_brachy/tests/phsp_scoring/phsp_score.egsinp">tests/phsp_scoring/phsp_score.egsinp</a> for an example.</li>
<li>'dose file format': (Optional) Controls whether 3dddose files are written as text or gzipped text files. Options are 'text' (default) and 'gzip'.</li>
<li>'output egsphant files': (Optional) Controls whether egsphant files are created for scoring phantoms. Options are 'no' (default) and 'yes'.</li>
<li>'egsphant file format': (Optional) Controls whether egsphant files are written as text or gzipped text files. Options are 'text' (default) and 'gzip'.</li>
<li>'output voxel info files': (Optional) Controls whether voxel info files are created for scoring phantoms. Options are 'no' (default) and 'yes'. See below for a description of these files. See <a href="https://github.com/clrp-code/egs_brachy/blob/master/egs_brachy/tests/volume_correction/vc.egsinp">tests/volume_correction/vc.egsinp</a> for an example.</li>
<li>'voxel info file format': (Optional) Controls whether voxel info files are written in text (default) or gzip format</li>
<li>'output volume correction files for phantoms': (Optional) Controls which phantoms will have volume correction files created.</li>
<li>'volume correction file format': (Optional) Controls whether volume correction files are written in text (default) or gzip format</li>
<li>'record initial particle positions': (Optional) If this is set to a number N, where N &gt; 0, then the first N initial particle positions will be written to a .pinit file. You can use this file to visualize the initial particle positions using gnuplot for example.</li>
<li>'current result phantom region': (Optional) Controls which phantom region is used for displaying results at the end of each batch and/or terminating the calculation if the required statistical uncertainty is reached. Defaults to region 0 of the first phantom object. Currently the result of the tracklength dose scoring is always used. See <a href="https://github.com/clrp-code/egs_brachy/blob/master/egs_brachy/tests/brem_cyl/brem_cyl.egsinp">tests/brem_cyl/brem_cyl.egsinp</a> for an example.</li>
<li>'dose scaling factor': (Optional) Allows you to scale all dose files output by egs_brachy by a constant factor.</li>
</ul>
<p>A sample 'scoring options' block looks like this: </p><pre class="fragment">:start scoring options:

    score tracklength dose = yes # 'yes' (default) or 'no'
    score energy deposition = no # 'no' (default) or 'yes'
    score scatter dose = yes # 'no' (default) or 'yes'
    muen file = /home/randlet/egs/HEN_HOUSE/muen_data/brachy_xcom_1.5MeV.muendat
    muen for media = WATER_0.998, AIR_TG43

    dose file format = gzip # text or gzip

    output egsphant files = yes
    egsphant file format = gzip

    output voxel info files = no
    voxel info file format = text # text or gzip

    output volume correction files for phantoms = phantom1, phantom2
    volume correction file format = gzip # text or gzip

    current result phantom region = phantom 123  # phant name and reg number

    dose scaling factor = 1

    :start spectrum scoring:
        type = surface count
        particle type = photon
        minimum energy = 0.001
        maximum energy = 0.040
        number of bins = 100
        output format = xmgr
    :stop spectrum scoring:

    :start phsp scoring:
        phsp output directory = /home/randlet/egs/egsnrc/egs_brachy/
        access mode = write
        print header = no
        kill after scoring = yes
    :stop phsp scoring:

:stop scoring options:</pre><h3><a class="anchor" id="vcfiles"></a>
Volume correction files</h3>
<p>If one or more phantoms are specfied in 'output volume correction files for phantoms' then egs_brachy will output a file containing region numbers and the corrected volumes for any regions which has had its volume corrected.</p>
<p>File mode is specified with the 'volume correction file format' input and can either be 'text' or 'gzip'.</p>
<p>These volume correction files allow you to precompute volume corrections for a given geometry arrangement and can then be used in conjunction with the 'volume correction from file' volume correction option. This can be particularly useful when running a simulation in parallel. A single job in "volume
correction only" mode can be run to initially calculate the volume corrections and then the parallel jobs can use the precomputed volume corrections values eliminating the redundant calculation of volume corrections by every job in your parallel run.</p>
<p>The input file <a href="https://github.com/clrp-code/egs_brachy/blob/master/egs_brachy/tests/volume_correction/vc.egsinp">tests/volume_correction/vc.egsinp</a> demonstrates this feature.</p>
<h3><a class="anchor" id="specscoring"></a>
Spectrum Scoring Options</h3>
<p>egs_brachy can currently score three different type of spectra:</p>
<ol type="1">
<li>Absolute counts of particles escaping the surface of the source (See <a href="https://github.com/clrp-code/egs_brachy/blob/master/egs_brachy/tests/spec_absolute/spec_absolute.egsinp">tests/spec_absolute/spec_absolute.egsinp</a>)</li>
<li>Energy weighted spectra of particles on the surface of the source (See <a href="https://github.com/clrp-code/egs_brachy/blob/master/egs_brachy/tests/spec_eflu/spec_eflu.egsinp">tests/spec_eflu/spec_eflu.egsinp</a>)</li>
<li>Photon energy fluence in a single geometry region (See <a href="https://github.com/clrp-code/egs_brachy/blob/master/egs_brachy/tests/spec_vox/spec_vox.egsinp">tests/spec_vox/spec_vox.egsinp</a>)</li>
</ol>
<p>To score a spectrum, add one or more 'spectrum scoring' input blocks to the 'scoring options' block (you may add an arbitrary number of 'spectrum scoring' blocks.)</p>
<p><b>Note that for the 'energy fluence in region' spectrum type, it is essential that the scoring region has no other overlapping geometries.</b></p>
<p>Spectrum scoring input options are explained below.</p>
<pre class="fragment">:start scoring options:

    ...


    :start spectrum scoring:
        type = surface count # surface count, energy weighted surface, energy fluence in region
        particle type = photon # photon, electron, positron
        minimum energy = 0.001 # defaults to 0.001MeV
        maximum energy = 1.00 # defaults to max energy of source
        number of bins = 1000  # defaults to 100
        output format = xmgr # xmgr (default), csv, egsnrc

        file extension = my_spectrum # (optional)

        # egsnrc 'output format' only
        egsnrc format mode = 0 # 0, 1, 2

        # 'energy fluence in region' mode only
        geometry  = your_geom_name
        scoring region = 10 # region of specified geometry to score fluence in (defaults to 0 )

    :stop spectrum scoring:

:stop scoring options:</pre><h3><a class="anchor" id="phspscoring"></a>
Phase Space Scoring Options</h3>
<p>egs_brachy has the ability to score an IAEA format phase space file of all particles escaping the source geometry. This phase space can then be used as a particle source in future simulations with the eb_iaeaphsp_source source type (see Phase Space Source section below).</p>
<p>To enable this option you need to add a <code>phsp scoring</code> block to the <code>scoring options</code> input section. The <code>phsp scoring</code> block has the following inputs:</p>
<ol type="1">
<li>'phsp output directory': (Optional) Controls where the .IAEAheader &amp; .IAEAphsp files are written too. Defaults to the current working directory.</li>
<li>'access mode': (Optional) Controls whether egs_brachy should write to a new file or append to an existing phsp file. Options are <code>write</code> and <code>append</code> (default).</li>
<li>'kill after scoring': (Optional) Controls whether the weight of scored particles should be set to 0 which will increase the speed of phase space file generation. Options are <code>yes</code> and <code>no</code> (default).</li>
<li>'boundary step': (Optional) Since egs_brachy scores phsp particles on the surface of a source, you may find that when you use a phsp source, particles get stuck at the geometry boundary when they are initialized. To combat this, before scoring a phsp particle egs_brachy propagates the particle a small distance forward along its current direction of travel before writing it to the phase space file. By default this value is 1E-4 cm but you can make it smaller or larger if necessary.</li>
<li>'print header': (Optional) Controls whether the iaea_print_header function is called during the outputResults. Options are <code>yes</code> and <code>no</code> (default).</li>
</ol>
<p>A complete phsp scoring block looks like:</p>
<pre class="fragment">    :start phsp scoring:
        phsp output directory = /home/randlet/egs/egsnrc/egs_brachy/
        access mode = write
        print header = no
        kill after scoring = yes
        boundary step = 1E-6
    :stop phsp scoring:</pre><p>See <a href="https://github.com/clrp-code/egs_brachy/blob/master/egs_brachy/tests/phsp_scoring/phsp_score.egsinp">tests/phsp_scoring/phsp_score.egsinp</a> for an example of scoring a phase space and <a href="https://github.com/clrp-code/egs_brachy/blob/master/egs_brachy/tests/phsp_run/phsp_run.egsinp">tests/phsp_run/phsp_run.egsinp</a> for an example of running a phase space source.</p>
<h4>Limitations</h4>
<p>Currently phase space generation using parallel runs is not supported.</p>
<h2><a class="anchor" id="sourcedef"></a>
Source definition</h2>
<p>The <code>source definition</code> block for egs_brachy consists of 3 parts:</p>
<ol type="1">
<li>a standard egs++ <code>source</code> block which defines what the base particle source and spectrum will be (typically for brachy calculations this will be an isotropic source).</li>
<li>a <code>transformations</code> input block which contains one or more EGS_AffineTransform input blocks to tell egs_brachy the location of all particle sources (this will usually be identical to the <code>inscribed geometry -&gt; transformations</code> block for an egs_autoenvelope geometry and hence an external file and an <code>include file</code> directive should probably be used.)</li>
<li>a <code>simulation source</code> input item which is set to the name of the source defined in 1.</li>
<li>an optional <code>source weights</code> input item which is a list of relative statistical weights for each source. This input is described below in the <code>Variable source weights</code> section.</li>
</ol>
<p>An example <code>source definition</code> block is shown below for a 6702 seed: </p><pre class="fragment">:start source definition:

  :start source:

      library = egs_isotropic_source
      name = 6702_spheres
      charge = 0

      # three spherical shell sources for 6702 Source
      :start shape:

          library = egs_shape_collection

          :start shape:
              library = egs_spherical_shell
              inner radius = 0.0299
              outer radius = 0.03
              midpoint = 0, 0, -0.11
          :stop shape:

          :start shape:
              library = egs_spherical_shell
              inner radius = 0.0299
              outer radius = 0.03
              midpoint = 0, 0, 0
          :stop shape:

          :start shape:
              library = egs_spherical_shell
              inner radius = 0.0299
              outer radius = 0.03
              midpoint = 0, 0, 0.11
          :stop shape:

          probabilities = 1 1 1

      :stop shape:

      :start spectrum:
          type = tabulated spectrum
          spectrum file = /home/randlet/egs/HEN_HOUSE/spectra/I125_TG43.spectrum
      :stop spectrum:

  :stop source:

  :start transformations :
      :start transformation:
          translation = -2,-2,-2
      :stop transformation:
      :start transformation:
          translation = -2,-2,-1
      :stop transformation:

      # more transformations...

  :stop transformations:

  simulation source = 6702_spheres

:stop source definition:</pre><h3><a class="anchor" id="varweight"></a>
Variable source weighting</h3>
<p>In order to simulate sources with different activity levels you can add a <code>source weights</code> input to the <code>source definition</code> section. For example, if you have a simualtion with two sources, the first of which has three times the activity of the second, you would set the following source input:</p>
<pre class="fragment">:start source definition:

  :start source:

      library = egs_point_source
      name = pt_source
      charge = 0
      position = 0 0 0

      :start spectrum:
          type = tabulated spectrum
          spectrum file = /home/randlet/egs/HEN_HOUSE/spectra/I125_TG43.spectrum
      :stop spectrum:

  :stop source:

  :start transformations :
      :start transformation:
          translation = 0 0 -1
      :stop transformation:
      :start transformation:
          translation = 0 0 1
      :stop transformation:
  :stop transformations:

  simulation source = pt_source

  source weights = 3 1 # give source at (0, 0, -1) three times the weight of source 2

:stop source definition:</pre><p>egs_brachy uses these weights to assign the initial statistical weight of the particles originating in a source. If the <code>source weights</code> input is missing all sources are given equal weighting. If the number of inputs for source weights is less than the number of sources, the missing inputs will be assumed to be 1. See <a href="https://github.com/clrp-code/egs_brachy/blob/master/egs_brachy/tests/variable_activity/variable.egsinp">tests/variable_activity/variable.egsinp</a> for an example.</p>
<p>When the <code>superposition</code> run mode is used, the <code>source weights</code> input represents relative dwell times (e.g. for a stepped Ir192 HDR source) rather than different activity levels. See <a href="https://github.com/clrp-code/egs_brachy/blob/master/egs_brachy/tests/stepped_source/stepped.egsinp">tests/stepped_source/stepped.egsinp</a> for an example of this feature.</p>
<h3><a class="anchor" id="phspsources"></a>
Phase Space Sources</h3>
<p>Using an IAEA phase space source in egs_brachy is just a matter of setting the <code>source</code> input block to use the eb_iaeaphsp_source type like so:</p>
<pre class="fragment">:start source definition:

    :start source:
        library = eb_iaeaphsp_source
        name = 6702
        header file = /home/randlet/egs/egsnrc/egs_brachy/iaea.phsp.IAEAheader
    :stop source:

    :start transformations :
        include file = lib/geometry/transformations/125seeds_1cm_grid
    :stop transformations:

    simulation source = 6702

:stop source definition:</pre><p>See the eb_iaeaphsp_source documenation for more information on the inputs and <a href="https://github.com/clrp-code/egs_brachy/blob/master/egs_brachy/tests/phsp_run/phsp_run.egsinp">tests/phsp_run/phsp_run.egsinp</a> input file for an example of this feature.</p>
<p>It should be noted that phase space sources are treated slightly differently than other source types when particle recycling is enabled. This is discussed below in the particle recycling section.</p>
<h2><a class="anchor" id="transport"></a>
Transport Parameters</h2>
<p>egs_brachy has a couple of extra optional transport parameters.</p>
<ol type="1">
<li><code>Fluorescent Photon Cutoff</code> which will kill all fluorescent photons with energy less than or equal to the cutoff energy. <pre class="fragment">:start MC transport parameter:

    Global ECUT                    = 1.512
    Global PCUT                    = 0.001
    # ...
    Fluorescent Photon Cutoff      = 0.005 # kill all flu. photons with E &lt;= 5keV

:stop MC transport parameter:</pre></li>
<li><code>Source ECUT</code> &amp; <code>Source PCUT</code> these two transport parameters allow you to set ECUT and PCUT to different values within the source compared to elsewhere. This is required for x-ray source simulations (see e.g. <a href="https://github.com/clrp-code/egs_brachy/blob/master/egs_brachy/tests/brem_cyl/brem_cyl.egsinp">tests/brem_cyl/brem_cyl.egsinp</a>).</li>
</ol>
<pre class="fragment">:start MC transport parameter:

    Global ECUT                    = 1.512
    Global PCUT                    = 0.001
    Source ECUT                    = 0.512
    Source PCUT                    = 0.001

:stop MC transport parameter:
</pre><h2><a class="anchor" id="varreduction"></a>
Variance Reduction</h2>
<h3><a class="anchor" id="recycling"></a>
Particle Recycling</h3>
<p>egs_brachy has the ability to reuse particles which escape from the source geometry an arbitrary number of times. With particle recycling enabled, egs_brachy detects (in ausgab) when a particle is escaping the source, and then adds Nrecycle new particles to the top of the stack at the location of each source in the simulation.</p>
<p>This can increase the efficiency of a simulation where only a fraction of particles are escaping the source geometry (since particles which don't escape the source geometry are 'wasted' because they don't contribute to dose in the phantom).</p>
<p>In order to enable source particle recycling you must include a <code>particle recycling</code> block in the <code>variance reduction</code> block.</p>
<pre class="fragment">:start variance reduction:
    :start particle recycling:
        times to reuse recycled particles = 10
        rotate recycled particles = yes
    :stop particle recycling:
:stop variance reduction:</pre><p>If <code>rotate recycled particles</code> is set to yes, each particle will be rotated by an arbitrary angle about the z-axis prior to being reused. (If <code>times to reuse recycled particles</code> is greater than 1, particle rotation is enforced).</p>
<p>Examples of particle recycling may be seen in the following test files: <a href="https://github.com/clrp-code/egs_brachy/blob/master/egs_brachy/tests/phsp_run/phsp_run.egsinp">tests/phsp_run/phsp_run.egsinp</a>, <a href="https://github.com/clrp-code/egs_brachy/blob/master/egs_brachy/tests/recycling/recycling.egsinp">tests/recycling/recycling.egsinp</a>, <a href="https://github.com/clrp-code/egs_brachy/blob/master/egs_brachy/tests/tg43mode_recycle/tg43mode_recycling.egsinp">tests/tg43mode_recycle/tg43mode_recycling.egsinp</a>, <a href="https://github.com/clrp-code/egs_brachy/blob/master/egs_brachy/tests/variable_w_recycling/variable_w_recycling.egsinp">tests/variable_w_recycling/variable_w_recycling.egsinp</a>.</p>
<h4>Particle Recycling with PHSP Sources</h4>
<p>Phase space particles are scored once they've already escaped the source and therefore particles from a phsp source will be initiated outside of sources. Because of this phsp particles never escape the source and trigger the recycling routines in ausgab. Instead, at the beginning of each history a single particle is retrieved from the phase space file and then NRecycle copies of the particle are made and placed at the location of all the sources (so the history starts with NRecyle*NSource particles on the stack rather than just a single particle).</p>
<h4>Particle Recycling and Superposition Mode</h4>
<p>Currently when running in superposition mode recycled particles are only generated for the currently active source rather than all source locations ( i.e. when a particle escapes a source only <code>Nrecycle</code> particles are created rather than <code>Nrecycle*Nsource</code>).</p>
<h3><a class="anchor" id="rangerejection"></a>
Range Rejection</h3>
<p>Range rejection is enabled outside of sources and disabled within sources by default in egs_brachy. The default maximum range rejection energy is set to 2.511 MeV (including rest mass). In other words, by default range rejection is applied to electrons in the phantom with kinetic energy lower than 2 MeV. To enable or disable range rejection within sources, or outside of sources, use the <code>source range rejection</code> and <code>global range rejection</code> inputs, respectively.</p>
<p>The <code>source range rejection max energy</code> and <code>global range rejection max energy</code> inputs are used to set the maximum energy of electrons (in MeV, including rest mass) to use range rejection with.</p>
<pre class="fragment">:start variance reduction:
    global range rejection = yes
    global range rejection max energy = 0.611
    source range rejection = yes
    source range rejection max energy = 0.516
:stop variance reduction:</pre><h3><a class="anchor" id="bremsplit"></a>
Bremsstrahlung Splitting</h3>
<p>To enable brem splitting in egs_brachy set the <code>split brems photons</code> input to something greater than 1 in the <code>variance reduction</code> block.</p>
<pre class="fragment">:start variance reduction:
    split brem photons = 100
:stop variance reduction:</pre><p>See <a href="https://github.com/clrp-code/egs_brachy/blob/master/egs_brachy/tests/brem_cyl/brem_cyl.egsinp">tests/brem_cyl/brem_cyl.egsinp</a> for an input file that uses brem splitting.</p>
<h3><a class="anchor" id="bcse"></a>
Bremsstrahlung Cross Section Enhancement</h3>
<p>To enable bremsstrahlung cross section enhancement in egs_brachy add a <code>bcse medium</code> input item in the <code>variance reduction</code> block. The format of the input is <code>medium_name enhancement_factor</code>.</p>
<pre class="fragment">:start variance reduction:
    split brem photons = 100
    bcse medium =  Ti10W90 100
:stop variance reduction:</pre><h2><a class="anchor" id="voxvc"></a>
Voxel volume correction details</h2>
<p>egs_brachy has three methods available for doing voxel volume correction calculations. There is a 'fast' method that uses the same technique described in the egs_autoenvelope documentation and a more general purpose routine which can be used for larger volumes with multiple overlapping phantom geometries. In addition to those two methods, corrected voxel volumes can be precomputed (either manually or by egs_brachy) and read from a file.</p>
<p>See <a href="https://github.com/clrp-code/egs_brachy/blob/master/egs_brachy/tests/volume_correction/vc.egsinp">tests/volume_correction/vc.egsinp</a> for examples of the fast &amp; general volume correction methods.</p>
<h3><a class="anchor" id="sourcevc"></a>
Fast voxel volume corrections for sources</h3>
<p>The input block for this type of volume correction looks like:</p>
<pre class="fragment">:start volume correction:

    :start source volume correction:

        correction type = correct # optional: none(default), correct, zero dose
        density of random points (cm^-3) = 1E7 # optional random point sampling density defaults to 1E8

        # shape which encompasses source
        :start shape:
            type = cylinder
            radius = 0.04
            height = 0.45
        :stop shape:

        # optional rng definition
        :start rng definition:
            type = sobol
            initial seed = 1234
        :stop rng definition:

        # -or- #
        :start rng definition:
            type = ranmar
            initial seeds = two integers
        :stop rng definition:

    :stop source volume correction:

:stop volume correction:
</pre><h3><a class="anchor" id="genvc"></a>
General purpose volume corrections</h3>
<p>The general purpose algorithm is similar, except any geometry region within the bounding shape will have its region volume corrected Currently the shape must be cylinder, sphere, or box type.</p>
<p>The input block for the general purpose volume corrections is shown below:</p>
<pre class="fragment">:start volume correction:

    :start extra volume correction:

        correction type = correct # correct, none, zero dose
        density of random points (cm^-3) = 1E5

        # correct volume of region for all geometries within
        # x,y,z = +/- 2cm around origin
        :start shape:

            type = box
            box size = 4

            :start transformation:
                translation = 0 0 0
            :stop transformation:

        :stop shape:

    :stop extra volume correction:

:stop volume correction:</pre><h3><a class="anchor" id="vcfile"></a>
Volume calculations from file</h3>
<p>You can also use precomputed volume corrections by using a 'volume correction from file' input.</p>
<p>The input block specifies one or more 'phantom file' inputs with two strings. The first string is the name of the phantom to set the volumes for and the second string is the file to read the volumes from. egs_brachy will automatically determine whether the file is in text or gzip mode.</p>
<pre class="fragment">:start volume correction:

    :start volume correction from file:

        phantom file = phantom1 your_precomputed_phantom1_volumes.volcor
        phantom file = phantom2 your_precomputed_phantom2_volumes.volcor

    :stop volume correction from file:

:stop volume correction:</pre><p>To create your own volcor text files, create a text file in the format:</p>
<pre class="fragment">NRECORDS
REG_NUM_1 REG_1_VOLUME
REG_NUM_2 REG_2_VOLUME
...
REG_NUM_3 REG_3_VOLUME</pre><p>for example the following file:</p>
<pre class="fragment">3
5 0.5
13 1.0
1000 2.5</pre><p>would set regions 5, 13 and 1000 to volumes 0.5 cm^3, 1 cm^3, 2.5 cm^3 of whichever phantom it was assigned to.</p>
<h3><a class="anchor" id="rngvc"></a>
Random Number Generator for volume corrections</h3>
<p>If a <code>box</code> shape is used as the volume correction shape, volume corrections will use a Sobol Quasi Random Number Generator by default. For all other shapes the regular Ranmar RNG will be used (the Sobol generator only works for Cartesian coordinate systems). The RNG can be overridden as show in the example above.</p>
<h2><a class="anchor" id="outputfiles"></a>
Output files</h2>
<h3><a class="anchor" id="dosefiles"></a>
3ddose files</h3>
<p>A 3ddose file will be output for every phantom geometry named in the <code>geometry definition -&gt; phantom geometries</code> input item. The filename format of these 3ddose files is <code>{input_file}_{phantom_name}.3ddose</code> where <code>{input_file}</code> is replaced with the name of the simulations input file and <code>{phantom_name}</code> is replaced with the name of the phantom.</p>
<p>If <code>score energy deposition = yes</code> is set, a second 3ddose file with dose from interaction scoring will be output to <code>{input_file}_{phantom_name}.edep.3ddose</code> as well.</p>
<p>If <code>score scatter dose</code> is enabled, egs_brachy will score primary, single scattered and multiple scattered dose (normalized to total radiant energy) and output them to 3ddose files with the format <code>{input_file}_{phantom_name}.{pr,ss,ms,to}.3ddose</code></p>
<h3><a class="anchor" id="egsphant"></a>
egsphant file</h3>
<p>If the user sets <code>output egsphant files</code> to yes in the <code>scoring options</code> input block, an egsphant file will be output for each scoring phantom in the simulation.</p>
<pre class="fragment">:start scoring options:


    #...
    output egsphant files = yes

:stop scoring options:
</pre><h3><a class="anchor" id="voxinfo"></a>
Voxel info files</h3>
<p>If the user sets <code>output voxel info files</code> to yes in the <code>scoring options</code> input block, a file with a .voxels extension (<code>{input_file}_{phantom_name}.voxels</code>) will be output that contains region by region information about every voxel in a phantom. The information currently includes, region #, corrected volume, uncorrected volume, mass, density, medium, dose and uncertainy.</p>
<pre class="fragment">:start scoring options:


    #...
    output voxel info files = yes

:stop scoring options:
</pre><h2><a class="anchor" id="runsim"></a>
Running a simulation</h2>
<p>egs_brachy uses the standard egs++ <code>run control</code> input block to control the number of histories, batches, geometry erorr limits etc.. Likewise the standard methods of running EGSnrc user codes from the command line all apply to egs_brachy (i.e. use <code>ex</code>, <code>exb</code> or <code>egs_brachy -i input_file [-p pegs_file] [-o output_file] [-s] [-P n -j i]</code>)</p>
<h1><a class="anchor" id="runtests"></a>
Test Suite</h1>
<p>egs_brachy comes with a test suite that will allow you to confirm the code is still performing as expected after making modifications or updating the egsnrc version.</p>
<p>Geometries required for the tests are either defined within the .egsinp files or within <a href="https://github.com/clrp-code/egs_brachy/blob/master/egs_brachy/tests/test_geoms">tests/test_geoms</a>.</p>
<h2><a class="anchor" id="setup"></a>
Setup</h2>
<p>In order to make accurate CPU time comparisons the test suite needs to know how fast your CPU is. If you are on a linux system that makes processor speed available in <code>/proc/cpuinfo/</code> then the test suite can likely determine this information on its own. Otherwise you will need to set a <code>CPU_MHZ</code> environment variable with the value of your CPU speed in MHz (e.g. <code>CPU_MHZ=2400</code>).</p>
<h2><a class="anchor" id="testsuite"></a>
Running the test suite</h2>
<p>To run the test suite you need to be in the root egs_brachy directory. To run the whole test suite type (tested with Python 2.7 &amp; 3.4):</p>
<pre class="fragment">python run_tests.py
</pre><p>after which you should see output like:</p>
<pre class="fragment">~/egs/egsnrc/egs_brachy$ python run_tests.py
CPU speed read from /proc/cpuinfo as 3498.557000 MHz
Running test 'tests.volume_correction'...
PASS - tests.volume_correction - ran in 5.72E-05 s/MHz (0.2 s)
Running test 'tests.scatter'...
PASS - tests.scatter - ran in 0.0056 s/MHz (19.6 s)
Running test 'tests.seeds_in_xyz'...
...
Running test 'tests.spec_vox'...
PASS - tests.spec_vox - ran in 0.000829 s/MHz (2.9 s)
================================================================================
Tests finished 17/17 passed
~/egs/egsnrc/egs_brachy$
</pre><p>You can also run a subset of the tests in the following way:</p>
<pre class="fragment">~/egs/egsnrc/egs_brachy$ python run_tests.py tests/seeds_in_xyz/
CPU speed read from /proc/cpuinfo as 3498.557000 MHz
Running test 'tests.seeds_in_xyz'...
PASS - tests.seeds_in_xyz - ran in 0.00269 s/MHz (9.4 s)
================================================================================
Tests finished 1/1 passed
~/egs/egsnrc/egs_brachy$</pre><p>or</p>
<pre class="fragment">~/egs/egsnrc/egs_brachy$ python run_tests.py "tests/spec*"
CPU speed read from /proc/cpuinfo as 3498.557000 MHz
Running test 'tests.spec_eflu'...
PASS - tests.spec_eflu - ran in 0.000629 s/MHz (2.2 s)
Running test 'tests.spec_absolute'...
PASS - tests.spec_absolute - ran in 0.000629 s/MHz (2.2 s)
Running test 'tests.spec_vox'...
PASS - tests.spec_vox - ran in 0.000743 s/MHz (2.6 s)
================================================================================
Tests finished 3/3 passed
~/egs/egsnrc/egs_brachy$</pre><h2><a class="anchor" id="curtests"></a>
A list of the current tests</h2>
<p>A list of all the tests currently implemented can be found in the <a class="el" href="md_tests.html">egs_brachy tests page</a>.</p>
<h1><a class="anchor" id="library"></a>
The egs_brachy Library</h1>
<h2><a class="anchor" id="libgeom"></a>
The Geometry Library</h2>
<p>For a list of the current geometry objects available in the egs_brachy library, please see <a class="el" href="md_geom.html">the geometry library page</a>.</p>
<h2><a class="anchor" id="libtransport"></a>
Transport Parameters</h2>
<p>For a list of the current default transport parameter files available in the egs_brachy library, please see <a class="el" href="md_transport.html">the transport parameters page</a>.</p>
<h2><a class="anchor" id="libspectra"></a>
Spectra</h2>
<p>For a list of the current spectra available in the egs_brachy library, please see <a class="el" href="md_spectra.html">the spectra page</a>.</p>
<h2><a class="anchor" id="libmedia"></a>
Media &amp; Muen Data</h2>
<p>egs_brachy includes material files for pegsless runs and muen data for scoring dose in different media using the tracklength estimator. For a list of the current media available see <a class="el" href="md_media.html">here</a>.</p>
<h2><a class="anchor" id="libexamples"></a>
Example egsinp files</h2>
<p>A suite of input files is distributed with egs_brachy (found in lib/examples). These provide a good starting point for users new to egs_brachy.</p>
<h1><a class="anchor" id="makedocs"></a>
Documentation</h1>
<p>This egs_brachy Technical Reference Manual uses doxygen and Python to build its documentation. Documentation for the egs_brachy library and test suite are generated by a number of Python scripts located in the _docs directory. The Python scripts generate markdown documents based on the contents of the <code>lib</code> and <code>tests</code> directory. These markdown documents are then compiled to html by doxygen. A pdf of all the documentation will also be created and placed at <code>docs/pdf/egs_brachy_technical_manual.pdf</code>.</p>
<p>This document (<a class="el" href="egs__brachy_8md.html">egs_brachy.md</a>) and the scripts for generating the library and test documents are located in <code>_docs/</code> and the generated html is placed in <code>docs/</code> ( the documents in the <code>docs/</code> directory should not be modified manually).</p>
<p>To update the documentation simply run <code>make docs</code> and then commit the changes:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;make docs</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;git add _docs/ docs/</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;git commit -am &#39;your commit message&#39;</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
